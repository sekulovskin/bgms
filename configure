#!/bin/sh

# RcppParallel flags
RCPP_PARALLEL_CPPFLAGS=`"${R_HOME}/bin/Rscript" -e "cat(RcppParallel::CxxFlags())"`
RCPP_PARALLEL_LIBS=`"${R_HOME}/bin/Rscript" -e "cat(RcppParallel::LdFlags())"`

# Generate sources.mk using R
"${R_HOME}/bin/Rscript" R/generate_makevars_sources.R > src/sources.mk

# Substitute into Makevars
sed -e "s|@RCPP_PARALLEL_CPPFLAGS@|${RCPP_PARALLEL_CPPFLAGS}|" \
    -e "s|@RCPP_PARALLEL_LIBS@|${RCPP_PARALLEL_LIBS}|" \
src/Makevars.in > src/Makevars
