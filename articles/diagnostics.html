<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Diagnostics and Spike-and-Slab Summaries • bgms</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Diagnostics and Spike-and-Slab Summaries">
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bgms</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/comparison.html">Model Comparison with bgmCompare</a></li>
    <li><a class="dropdown-item" href="../articles/diagnostics.html">Diagnostics and Spike-and-Slab Summaries</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Getting Started with bgms</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Bayesian-Graphical-Modelling-Lab/bgms/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Diagnostics and Spike-and-Slab Summaries</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Bayesian-Graphical-Modelling-Lab/bgms/blob/main/vignettes/diagnostics.Rmd" class="external-link"><code>vignettes/diagnostics.Rmd</code></a></small>
      <div class="d-none name"><code>diagnostics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette illustrates how to inspect convergence diagnostics and
how to interpret spike-and-slab summaries in <strong>bgms</strong>
models. For some of the model variables spike-and-slab priors introduce
binary indicator variables that govern whether the effect is included or
not. Their posterior distributions can be summarized with inclusion
probabilities and Bayes factors.</p>
</div>
<div class="section level2">
<h2 id="example-fit">Example fit<a class="anchor" aria-label="anchor" href="#example-fit"></a>
</h2>
<p>We use a subset of the Wenchuan dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Bayesian-Graphical-Modelling-Lab.github.io/bgms/" class="external-link">bgms</a></span><span class="op">)</span></span>
<span></span>
<span><span class="op">?</span><span class="va">Wenchuan</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="va">Wenchuan</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/bgm.html">bgm</a></span><span class="op">(</span><span class="va">data</span>, seed <span class="op">=</span> <span class="fl">1234</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 7 rows with missing observations in the input matrix x.</span></span>
<span><span class="co">#&gt; Since na_action = listwise these rows were excluded from the analysis.</span></span></code></pre></div>
<p>Note: During fitting, progress bars are shown in interactive
sessions. In this vignette, they are suppressed for clarity. Sampling
can take a while; the progress bars usually help track progress.</p>
</div>
<div class="section level2">
<h2 id="convergence-diagnostics">Convergence diagnostics<a class="anchor" aria-label="anchor" href="#convergence-diagnostics"></a>
</h2>
<p>The quality of the Markov chain can be assessed with common MCMC
diagnostics:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">$</span><span class="va">pairwise</span></span>
<span><span class="co">#&gt;                          mean          sd         mcse     n_eff</span></span>
<span><span class="co">#&gt; intrusion-dreams  0.630465218 0.001505695 0.0645952597 1840.4640</span></span>
<span><span class="co">#&gt; intrusion-flash   0.336939066 0.001279900 0.0615246748 2310.7156</span></span>
<span><span class="co">#&gt; intrusion-upset   0.198665557 0.067666296 0.0035274998  367.9686</span></span>
<span><span class="co">#&gt; intrusion-physior 0.191577877 0.071227938 0.0050170985  201.5559</span></span>
<span><span class="co">#&gt; dreams-flash      0.499277762 0.001398210 0.0596431449 1819.6018</span></span>
<span><span class="co">#&gt; dreams-upset      0.230190853 0.055082965 0.0014218947 1500.7203</span></span>
<span><span class="co">#&gt; dreams-physior    0.005329141 0.021891564 0.0008594282  648.8352</span></span>
<span><span class="co">#&gt; flash-upset       0.007130963 0.025475978 0.0010207513  622.9050</span></span>
<span><span class="co">#&gt; flash-physior     0.309372051 0.001159184 0.0533283561 2116.4689</span></span>
<span><span class="co">#&gt; upset-physior     0.712758036 0.001639670 0.0602202440 1348.8769</span></span>
<span><span class="co">#&gt;                       Rhat</span></span>
<span><span class="co">#&gt; intrusion-dreams  1.000830</span></span>
<span><span class="co">#&gt; intrusion-flash   1.001655</span></span>
<span><span class="co">#&gt; intrusion-upset   1.011155</span></span>
<span><span class="co">#&gt; intrusion-physior 1.009193</span></span>
<span><span class="co">#&gt; dreams-flash      1.001358</span></span>
<span><span class="co">#&gt; dreams-upset      1.004926</span></span>
<span><span class="co">#&gt; dreams-physior    1.003559</span></span>
<span><span class="co">#&gt; flash-upset       1.001278</span></span>
<span><span class="co">#&gt; flash-physior     1.003235</span></span>
<span><span class="co">#&gt; upset-physior     1.002455</span></span></code></pre></div>
<ul>
<li>R-hat values close to 1 (typically below 1.01) suggest convergence
<span class="citation">(<a href="#ref-VehtariEtAl_2021">Vehtari et al.,
2021</a>)</span>.</li>
<li>The effective sample size (ESS) reflects the number of independent
samples that would provide equivalent precision. Larger ESS values
indicate more reliable estimates.</li>
<li>The Monte Carlo standard error (MCSE) measures the additional
variability introduced by using a finite number of MCMC draws. A small
MCSE relative to the posterior standard deviation indicates stable
estimates, whereas a large MCSE suggests that more samples are
needed.</li>
</ul>
<p>Advanced users can inspect traceplots by extracting raw samples and
using external packages such as <code>coda</code> or
<code>bayesplot</code>. Here is an example using the <code>coda</code>
package to create a traceplot for a pairwise effect parameter.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span></span>
<span></span>
<span><span class="va">param_index</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">chains</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">raw_samples</span><span class="op">$</span><span class="va">pairwise</span>, <span class="kw">function</span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="va">mat</span><span class="op">[</span>, <span class="va">param_index</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mcmc_obj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">chains</span>, <span class="va">mcmc</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">mcmc_obj</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"firebrick"</span>, <span class="st">"steelblue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"goldenrod"</span><span class="op">)</span>, </span>
<span>          main <span class="op">=</span> <span class="st">"Traceplot of pairwise[1]"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="diagnostics_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="spike-and-slab-summaries">Spike-and-slab summaries<a class="anchor" aria-label="anchor" href="#spike-and-slab-summaries"></a>
</h2>
<p>The spike-and-slab prior yields posterior inclusion probabilities for
edges:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">$</span><span class="va">indicator</span></span>
<span><span class="co">#&gt;           intrusion dreams  flash   upset physior</span></span>
<span><span class="co">#&gt; intrusion   0.00000 1.0000 1.0000 0.93975  0.0570</span></span>
<span><span class="co">#&gt; dreams      1.00000 0.0000 0.9665 1.00000  0.0745</span></span>
<span><span class="co">#&gt; flash       1.00000 0.9665 0.0000 0.99800  1.0000</span></span>
<span><span class="co">#&gt; upset       0.93975 1.0000 0.9980 0.00000  1.0000</span></span>
<span><span class="co">#&gt; physior     0.05700 0.0745 1.0000 1.00000  0.0000</span></span></code></pre></div>
<ul>
<li>Values near 1.0: strong evidence the edge is present.</li>
<li>Values near 0.0: strong evidence the edge is absent.</li>
<li>Values near 0.5: inconclusive (absence of evidence).</li>
</ul>
</div>
<div class="section level2">
<h2 id="bayes-factors">Bayes factors<a class="anchor" aria-label="anchor" href="#bayes-factors"></a>
</h2>
<p>When the prior inclusion probability for an edge is equal to 0.5
(e.g., using a Bernoulli prior with
<code>inclusion_probability = 0.5</code> or a symmetric Beta prior,
<code>main_alpha = main_beta</code>), we can directly transform
inclusion probabilities into Bayes factors for edge presence vs
absence:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example for one edge</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">$</span><span class="va">indicator</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span></span>
<span><span class="va">BF_10</span> <span class="op">=</span> <span class="va">p</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span></span>
<span><span class="va">BF_10</span></span>
<span><span class="co">#&gt; [1] 0.06044539</span></span></code></pre></div>
<p>Here the Bayes factor in favor of inclusion (H1) is small, meaning
that there is little evidence for inclusion. Since the Bayes factor is
transitive, we can use it to express the evidence in favor of exclusion
(H0) as</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">/</span> <span class="va">BF_10</span></span>
<span><span class="co">#&gt; [1] 16.54386</span></span></code></pre></div>
<p>This Bayes factor shows that there is strong evidence for the absence
of a network relation between the variables <code>intrusion</code> and
<code>physior</code>.</p>
</div>
<div class="section level2">
<h2 id="notes-on-runtime">Notes on runtime<a class="anchor" aria-label="anchor" href="#notes-on-runtime"></a>
</h2>
<ul>
<li>Sampling with spike-and-slab priors can take longer.</li>
<li>In interactive sessions, progress bars are displayed. In this
vignette, they are suppressed for readability.</li>
</ul>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>See <em>Getting Started</em> for a simple one-sample workflow.</li>
<li>See <em>Model Comparison</em> for group differences.</li>
</ul>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-VehtariEtAl_2021" class="csl-entry">
Vehtari, A., Gelman, A., Simpson, D., Carpenter, B., &amp; Bürkner,
P.-C. (2021). Rank-normalization, folding, and localization: An improved
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>R</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{R}</annotation></semantics></math>
for assessing convergence of MCMC. <em>Bayesian Analysis</em>,
<em>16</em>(2), 667–718. <a href="https://doi.org/10.1214/20-BA1221" class="external-link">https://doi.org/10.1214/20-BA1221</a>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Maarten Marsman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer>
</body>
</html>
